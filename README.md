# Pinterest Split + Fabric Board (Chrome Extension)

Pinterest の画面を **3:7** に分割し、右側に **Fabric.js** 製のボードを常時表示します。  
画像を **ドラッグ&ドロップ／貼り付け／URL／ファイル** から追加でき、**最大 8 枚**を並べてレイアウト。  
ボードは **IndexedDB（画像は Blob、ボード状態は JSON）** に自動保存され、**Undo/Redo（最大20回）** と **画像コピー（Ctrl/⌘+C）** に対応します。

---

## 主な機能
- **画面分割**：Pinterest を左、**ボードを右（30%幅）** に固定表示
- **画像追加**：
    - **ドラッグ&ドロップ**（ファイル、URL）
    - **クリップボード貼り付け**（画像やURL）
    - **URL直指定のフェッチ**（CORS 通る場合は Blob 保存）
- **自動リサイズ配置**：キャンバス内に収まるようセンタ基準でスケール
- **枚数制限**：**最大 8 枚**。超過時は古い順に自動削除し、Undo可能
- **Undo / Redo（20ステップ）**：
    - 追加・削除・変形（移動/拡縮/回転/不透明度等）が対象
    - まとめ追加は**1ステップ**にバッチング（D&D/貼り付け/複数ファイル）
- **画像コピー**：**Ctrl/⌘+C** で選択中の **単一画像** を PNG で**クリップボードへ**（2x 解像度でレンダ）
- **自動保存**：操作のたびに**IndexedDB** に保存（画像は Blob、ボードは JSON）
- **ガーベジコレクション（GC）**：参照されなくなった画像 Blob を**猶予10分**後に定期削除
- **二重起動ガード** と **エラーフック**：重複注入の抑止とデバッグログ（`alphabetical`/`uiState` 文字列を含む例外を捕捉）

---

## キーボードショートカット

| 操作 | ショートカット | 備考 |
|---|---|---|
| Undo | **Ctrl/⌘ + Z** | 直近の操作を戻す（最大20） |
| Redo | **Ctrl/⌘ + Shift + Z** または **Ctrl/⌘ + Y** | やり直し |
| 削除 | **Delete / Backspace** | 選択オブジェクトを削除（Undo可） |
| 画像コピー | **Ctrl/⌘ + C** | **単一画像選択時のみ** PNG をクリップボードへ |

> 入力中のフォーム/テキストエリアにフォーカスがある場合はショートカットを抑制します。

---

## 保存方式とGC

- **IndexedDB**
    - **`images`**：`{ id, blob, type, created }`（実体画像を Blob で保存）
    - **`boards`**：`{ id: "main", json, updated }`（Fabric JSON）
- **自動保存**：操作後 400ms デバウンスで保存
- **GC（参照されないBlobの削除）**：
    - キャンバス上・Undo/Redo スタック・確定待ちバッチ内の **参照中 Blob** を収集
    - 10分以上参照されない Blob を定期削除（頻度は最低2分間隔）

> すべて **ローカルのみ** に保存され、ネットワーク送信は行いません。
